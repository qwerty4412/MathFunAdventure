name: Unity Master Pipeline (Self-Hosted)

on:
  push:
    branches:
      - PC-branch-number-2
      - main

jobs:
  build:
    name: Build for Windows
    # This ensures it ONLY runs on your laptop
    runs-on: self-hosted 
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          lfs: true
          clean: false

      - name: Run Build Command
        shell: powershell
        run: |
          # Create build directory if it doesn't exist
          New-Item -ItemType Directory -Force -Path "build/StandaloneWindows64"
          
          $unityPath = "C:\Program Files\Unity\Hub\Editor\6000.1.8f1\Editor\Unity.exe"
          
          Write-Host "Starting Unity Build on Local Machine..."
          
          # This runs your local Unity.exe directly
          & $unityPath -batchmode -quit -projectPath . -buildWindows64Player "build/StandaloneWindows64/MathFunAdventure.exe" -logFile build_log.txt
          
          if ($LASTEXITCODE -ne 0) {
            Write-Error "Unity Build Failed! Check build_log.txt for details."
            exit 1
          }

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: MathFunAdventure-PC-Build
          path: build/
          if-no-files-found: error